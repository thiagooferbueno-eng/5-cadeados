<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cadeados - Desafio</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#3bd671;
      --muted:#97a0b3;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: radial-gradient(ellipse at top left, #0b1a2b 0%, var(--bg) 40%), #071024;
      color:#e6eef8;
      padding:24px;
    }
    .wrapper{
      width:100%;
      max-width:900px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-radius:12px;
      padding:28px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.7);
    }
    h1{margin:0 0 8px 0;font-size:22px;}
    p.lead{margin:0 0 18px 0;color:var(--muted);}
    .locks{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
      gap:16px;
    }
    .lock{
      background:var(--card);
      border-radius:10px;
      padding:16px;
      border:1px solid rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:stretch;
    }
    .lock .top{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .icon{
      font-size:28px;
      width:48px;
      height:48px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:10px;
      background:var(--glass);
      flex-shrink:0;
    }
    .title{font-weight:600;}
    .status{font-size:13px;color:var(--muted);}
    input[type="text"]{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.06);
      background:rgba(255,255,255,0.02);
      color:inherit;
      outline:none;
      font-size:14px;
    }
    button{
      padding:10px 12px;
      border-radius:8px;
      border:0;
      cursor:pointer;
      font-weight:600;
      background:linear-gradient(90deg,var(--accent), #32b75a);
      color:#042018;
    }
    .row{display:flex;gap:8px;align-items:center;}
    .unlocked{
      color:#0b2a15;
      background: linear-gradient(90deg,#9af6b5,#3bd671);
      padding:6px 8px;
      border-radius:8px;
      font-weight:700;
      display:inline-block;
    }
    .disabled{
      opacity:0.45;
      pointer-events:none;
    }
    .final{
      margin-top:18px;
      padding:14px;
      background:linear-gradient(180deg, rgba(59,214,113,0.06), rgba(255,255,255,0.01));
      border-radius:10px;
      border:1px solid rgba(59,214,113,0.06);
    }
    .reveal{
      margin-top:12px;
      padding:12px;
      border-radius:8px;
      background:rgba(255,255,255,0.02);
      font-family:monospace;
      white-space:pre-wrap;
    }
    footer{margin-top:14px;color:var(--muted);font-size:13px;}
    @media (max-width:520px){
      .locks{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="wrapper" role="main">
    <h1>Desafio dos 5 Cadeados</h1>
    <p class="lead">Desbloqueie os cadeados na ordem correta. Se errar, pode tentar de novo ‚Äî mas n√£o deixe de seguir a ordem.</p>

    <div class="locks" id="locksContainer">
      <!-- cadeados gerados por JS -->
    </div>

    <div id="finalArea" class="final" style="display:none;">
      <strong>Parab√©ns ‚Äî todos os cadeados foram desbloqueados! üéâ</strong>
      <p class="status">As senhas (pr√™mio):</p>
      <div class="reveal" id="revealPasswords"></div>
      <div style="margin-top:10px;">
        <button id="copyBtn">Copiar senhas</button>
        <button id="resetBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;margin-left:8px;">Reiniciar</button>
      </div>
    </div>

    <footer>Observa√ß√£o: compara√ß√£o sem diferencia√ß√£o entre mai√∫sculas/min√∫sculas e sem acentos.</footer>
  </div>

  <script>
    // Senhas na ordem
    const originalPasswords = [
      "1953",
      "HongKong",
      "HTCS",
      "Taipei",
      "Tigres Asi√°ticos"
    ];

    // Normaliza (remove acentos e lower case) para comparar
    function normalizeText(s){
      if(!s && s !== "") return "";
      return s.normalize ? s.normalize('NFD').replace(/\p{Diacritic}/gu, '') : s;
    }

    function normLower(s){
      return normalizeText(s).toLowerCase().trim();
    }

    // Estado: qual √≠ndice foi desbloqueado (0..n-1). nextToUnlock = unlockedCount
    let unlockedCount = 0;

    const container = document.getElementById('locksContainer');
    const finalArea = document.getElementById('finalArea');
    const revealPasswords = document.getElementById('revealPasswords');
    const copyBtn = document.getElementById('copyBtn');
    const resetBtn = document.getElementById('resetBtn');

    // Tenta manter progresso entre recarregamentos (opcional)
    const STORAGE_KEY = 'cadeados_progress_v1';
    const saved = localStorage.getItem(STORAGE_KEY);
    if(saved){
      try{
        const s = JSON.parse(saved);
        if(typeof s.unlockedCount === 'number') unlockedCount = s.unlockedCount;
      }catch(e){}
    }

    function saveProgress(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify({unlockedCount}));
    }

    function createLockCard(index){
      const card = document.createElement('div');
      card.className = 'lock';
      const lockEmoji = index < unlockedCount ? 'üîì' : 'üîí';
      card.innerHTML = `
        <div class="top">
          <div class="icon">${lockEmoji}</div>
          <div style="flex:1">
            <div class="title">Cadeado ${index+1}</div>
            <div class="status" id="status-${index}">${index < unlockedCount ? 'Desbloqueado' : (index === unlockedCount ? 'Aguardando tentativa' : 'Bloqueado (ordem)')}</div>
          </div>
          <div style="min-width:90px;text-align:right">
            <div style="font-size:13px;color:var(--muted)">Tentativas:</div>
            <div id="tries-${index}" style="font-weight:700">0</div>
          </div>
        </div>

        <div class="row" style="margin-top:6px;">
          <input type="text" id="input-${index}" placeholder="Digite a senha" ${index === unlockedCount ? '' : 'disabled'} aria-label="Senha do cadeado ${index+1}">
          <button id="btn-${index}" ${index === unlockedCount ? '' : 'disabled'}>Verificar</button>
        </div>
      `;

      // evento
      const input = card.querySelector(`#input-${index}`);
      const btn = card.querySelector(`#btn-${index}`);
      const statusEl = card.querySelector(`#status-${index}`);
      const triesEl = card.querySelector(`#tries-${index}`);
      let tries = 0;

      function setDisabledForLater(){
        // desativa se n√£o for o pr√≥ximo
        if(index !== unlockedCount){
          input.disabled = true;
          btn.disabled = true;
          card.classList.add('disabled');
        } else {
          input.disabled = false;
          btn.disabled = false;
          card.classList.remove('disabled');
        }
        // atualiza icon e status
        const icon = card.querySelector('.icon');
        if(index < unlockedCount){
          icon.textContent = 'üîì';
          statusEl.textContent = 'Desbloqueado';
        } else if (index === unlockedCount){
          icon.textContent = 'üîí';
          statusEl.textContent = 'Aguardando tentativa';
        } else {
          icon.textContent = 'üîí';
          statusEl.textContent = 'Bloqueado (ordem)';
        }
      }

      btn.addEventListener('click', () => {
        const val = input.value || '';
        tries++;
        triesEl.textContent = tries;
        const correctNorm = normLower(originalPasswords[index]);
        const attemptNorm = normLower(val);
        if(attemptNorm === correctNorm){
          // desbloqueia
          unlockedCount = Math.max(unlockedCount, index+1);
          saveProgress();
          // atualiza todos os cards UI
          rebuildUI();
        } else {
          // pequena anima√ß√£o (shake)
          input.animate([{ transform: 'translateX(0)' }, { transform: 'translateX(-8px)' }, { transform: 'translateX(8px)' }, { transform: 'translateX(0)' }], { duration: 300 });
          statusEl.textContent = 'Senha incorreta ‚Äî tente novamente';
        }
      });

      input.addEventListener('keyup', (e) => {
        if(e.key === 'Enter') btn.click();
      });

      // exposer para atualiza√ß√µes
      card.setDisabledForLater = setDisabledForLater;
      return card;
    }

    // Cria todos os cards
    let cards = [];
    function buildCards(){
      container.innerHTML = '';
      cards = originalPasswords.map((p,i) => {
        const c = createLockCard(i);
        container.appendChild(c);
        return c;
      });
    }

    function rebuildUI(){
      // rebuild cards to reflect state (could be optimized but small)
      const inputs = container.querySelectorAll('input');
      const buttons = container.querySelectorAll('button');
      // Atualizar cada card
      cards.forEach((card, idx) => {
        // Recreate status and enabled state by calling method
        if(card.setDisabledForLater) card.setDisabledForLater();
        // additionally update tries display if exists (keeps previous)
      });

      // Se finalizado:
      if(unlockedCount >= originalPasswords.length){
        finalArea.style.display = 'block';
        revealPasswords.textContent = originalPasswords.map((p,i) => `${i+1} ‚Äî ${p}`).join('\\n');
      } else {
        finalArea.style.display = 'none';
      }

      // enable only the next card's input & button
      cards.forEach((card, idx) => {
        const input = card.querySelector('input');
        const btn = card.querySelector('button');
        const icon = card.querySelector('.icon');
        const statusEl = card.querySelector('.status');
        if(idx < unlockedCount){
          input.disabled = true;
          btn.disabled = true;
          icon.textContent = 'üîì';
          statusEl.textContent = 'Desbloqueado';
          card.classList.remove('disabled');
          // mark visually unlocked
          if(!card.querySelector('.unlocked-badge')){
            const badge = document.createElement('div');
            badge.className = 'unlocked-badge';
          }
        } else if (idx === unlockedCount){
          input.disabled = false;
          btn.disabled = false;
          icon.textContent = 'üîí';
          statusEl.textContent = 'Aguardando tentativa';
          card.classList.remove('disabled');
        } else {
          input.disabled = true;
          btn.disabled = true;
          icon.textContent = 'üîí';
          statusEl.textContent = 'Bloqueado (ordem)';
          card.classList.add('disabled');
        }
      });
    }

    // Inicializa UI
    buildCards();
    rebuildUI();

    // copiar senhas
    copyBtn.addEventListener('click', () => {
      const txt = originalPasswords.map((p,i) => `${i+1} ‚Äî ${p}`).join('\\n');
      navigator.clipboard?.writeText(txt).then(() => {
        copyBtn.textContent = 'Copiado!';
        setTimeout(()=> copyBtn.textContent = 'Copiar senhas', 1500);
      }).catch(() => {
        alert('N√£o foi poss√≠vel copiar automaticamente. Selecione e copie manualmente.');
      });
    });

    resetBtn.addEventListener('click', () => {
      if(!confirm('Reiniciar progresso?')) return;
      unlockedCount = 0;
      localStorage.removeItem(STORAGE_KEY);
      // reset tries counts and inputs
      cards.forEach((card) => {
        const input = card.querySelector('input');
        const btn = card.querySelector('button');
        const tries = card.querySelector('[id^="tries-"]');
        if(input) input.value = '';
        if(tries) tries.textContent = '0';
      });
      rebuildUI();
    });

    // Pequena melhoria: exibir dica ao focar no input (opcional)
    container.addEventListener('focusin', (e) => {
      if(e.target.tagName === 'INPUT'){
        // nada por enquanto
      }
    });

    // Reconstruir se a p√°gina for recarregada (mant√©m progresso)
    window.addEventListener('load', () => {
      rebuildUI();
    });
  </script>
</body>
</html>
